<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>ELSIE INC</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:wght@600&family=Cinzel:wght@700&display=swap" rel="stylesheet">

  <style>
    :root{
      --px: 14;            /* snake tile size */
      --trail-steps: 560;  /* long tail so it reads like a frame */
      --band: 16vh;        /* spacing under top band */
      --dice: 76px;        /* dice size */
    }

    html, body {
      margin: 0;
      padding: 0;
      background: #000;
      color: #fff;
      font-family: 'Cormorant Garamond', serif;
      overflow-x: hidden;
      scroll-behavior: smooth;
      overflow-anchor: none;
    }

    /* Push content below the top overlay area */
    body { padding-top: var(--band); }

    /* Background slideshow */
    .background-img {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      max-height: 70vh;
      max-width: 70vw;
      width: auto;
      height: auto;
      opacity: 0.40;
      pointer-events: none;
      z-index: 0;
      filter: contrast(120%) grayscale(60%) brightness(1.05);
      transition: opacity 180ms linear;
    }
    .black-flicker {
      position: fixed;
      inset: 0;
      background: #000;
      opacity: 0;
      transition: opacity 120ms linear;
      z-index: 6;
      pointer-events: none;
    }

    /* Snake layer (on top of content) */
    #snake-canvas{
      position: fixed;
      inset: 0;
      width: 100vw;
      height: 100vh;
      z-index: 8;     /* above image, below dice/stats */
      pointer-events: none;
      opacity: 1;
    }

    /* LEFT: Dice (two) */
    .dice {
      position: fixed;
      top: calc(var(--band) + 2.6rem);
      left: 6vw;
      width: var(--dice);
      height: var(--dice);
      perspective: 900px;
      perspective-origin: 50% 50%;
      z-index: 12;
      filter: drop-shadow(0 10px 20px rgba(0,0,0,.45)) drop-shadow(0 0 18px rgba(255,255,255,.18));
    }
    .dice2 { top: calc(var(--band) + 13.3rem); left: 9vw; }

    .dice .gimbal{
      width:100%; height:100%;
      transform-style: preserve-3d;
      transform-origin: 50% 50%;
      transform: rotateX(-10deg) rotateY(24deg) rotateZ(0deg);
      animation: wobble3d 6s ease-in-out infinite;
      will-change: transform;
    }
    @keyframes wobble3d{
      0%   { transform: rotateX(-10deg) rotateY(24deg) rotateZ(0deg); }
      50%  { transform: rotateX(-6deg)  rotateY(28deg) rotateZ(0deg); }
      100% { transform: rotateX(-10deg) rotateY(24deg) rotateZ(0deg); }
    }
    .dice, .dice .cube, .dice .face { transform-style: preserve-3d; }
    .dice .cube{
      position: relative; width: 100%; height: 100%;
      transition: transform 900ms cubic-bezier(.2,.8,.2,1);
      will-change: transform;
      transform: translateZ(0);
      cursor: pointer;
    }
    .dice .face{
      position: absolute; inset: 0;
      display: grid; grid-template: repeat(3,1fr) / repeat(3,1fr); place-items: center;
      background:
        radial-gradient(120% 120% at 30% 25%, rgba(255,255,255,.92), rgba(235,235,235,.9) 60%, rgba(215,215,215,.85) 100%);
      border-radius: 12px;
      border: 1px solid rgba(0,0,0,.08);
      box-shadow:
        inset 0 0 30px rgba(255,255,255,0.35),
        inset 0 0 8px rgba(0,0,0,0.15);
      backface-visibility: hidden;
      transform: translateZ(0);
    }
    .dice .pip{
      width: calc(var(--dice) * 0.16);
      height: calc(var(--dice) * 0.16);
      border-radius: 50%;
      background: radial-gradient(circle at 35% 35%, #000 0 45%, #333 46% 100%);
      box-shadow: 0 1px 0 rgba(255,255,255,.3), inset 0 1px 2px rgba(255,255,255,.25);
    }
    .dice .f1 { transform: translateZ(calc(var(--dice)/2)); }
    .dice .f2 { transform: rotateY(180deg) translateZ(calc(var(--dice)/2)); }
    .dice .f3 { transform: rotateY(90deg) translateZ(calc(var(--dice)/2)); }
    .dice .f4 { transform: rotateY(-90deg) translateZ(calc(var(--dice)/2)); }
    .dice .f5 { transform: rotateX(90deg) translateZ(calc(var(--dice)/2)); }
    .dice .f6 { transform: rotateX(-90deg) translateZ(calc(var(--dice)/2)); }

    /* RIGHT: Stats */
    .stats{
      position: fixed;
      right: 6vw;
      top: calc(var(--band) - 0.4rem);
      text-align: right;
      z-index: 14;
      user-select: none;
    }
    .stats .label{
      font-family: Helvetica, Arial, sans-serif;
      font-weight: 800;
      letter-spacing: .14em;
      font-size: .92rem;
      opacity: .9;
    }
    .stats .basket-line{
      margin-top: .4rem;
      font-family: Helvetica, Arial, sans-serif;
      letter-spacing: .14em;
      font-weight: 800;
      font-size: 1.0rem;
      opacity: .95;
    }
    .stats .basket-num{
      display: block;
      margin-top: .35rem;
      font-family: 'Cinzel', serif;
      font-weight: 700;
      font-size: clamp(1.3rem, 3.2vw, 2.1rem);
      text-shadow: 0 0 14px rgba(255,255,255,.35), 0 0 26px rgba(255,255,255,.18);
    }

    /* Countdown lower-right (roughly image bottom) */
    .countdown-box{
      position: fixed;
      right: 6vw;
      top: calc(50vh + 30vh); /* ≈ bottom of 70vh image */
      transform: translateY(-50%);
      text-align: right;
      z-index: 14;
      user-select: none;
    }
    .countdown-box .digits{
      font-family: Helvetica, Arial, sans-serif;
      font-weight: 900;
      font-size: clamp(1.8rem, 4.2vw, 2.8rem);
      letter-spacing: .04em;
      text-shadow: 0 0 14px rgba(255,255,255,.35), 0 0 26px rgba(255,255,255,.18);
      /* keep width stable so it doesn't “wiggle” */
      font-variant-numeric: tabular-nums lining-nums;
      -moz-font-feature-settings: "tnum" 1, "lnum" 1;
      -webkit-font-feature-settings: "tnum" 1, "lnum" 1;
      font-feature-settings: "tnum" 1, "lnum" 1;
    }

    /* One-off effects ONLY when a double happens */
    .match-bounce { animation: matchBounce .25s ease-out; }
    @keyframes matchBounce {
      0%   { transform: translateY(0) scale(1); }
      40%  { transform: translateY(-1px) scale(1.03); }
      100% { transform: translateY(0) scale(1); }
    }
    .match-flash  { animation: matchFlash .45s ease-out; }
    @keyframes matchFlash {
      0%,100% { color: inherit; text-shadow: 0 0 14px rgba(255,255,255,.25), 0 0 24px rgba(255,255,255,.15); }
      20%,60% { color: #ff3b3b; text-shadow: 0 0 18px rgba(255,0,0,.5), 0 0 28px rgba(255,0,0,.3); }
    }

    /* RED pair overlay */
    .combo-overlay{
      position: fixed; inset: 0;
      background:#c40000;
      display:flex; align-items:center; justify-content:center;
      opacity:0;
      visibility:hidden;
      transition: opacity .08s linear, visibility 0s linear .08s;
      z-index:10000;
      pointer-events:none;
    }
    .combo-overlay.show{
      opacity:1;
      visibility:visible;
      transition: opacity .08s linear;
    }
    .combo-overlay .big{
      font-family: Helvetica, Arial, sans-serif;
      font-weight: 900;
      font-size: clamp(6rem, 22vw, 28rem);
      color: #fff;
      letter-spacing: .08em;
      text-shadow: 0 0 24px rgba(255,255,255,.35);
    }

    .white-flash{
      position: fixed; inset: 0;
      background:#fff;
      opacity:0;
      transition: opacity .06s linear;
      z-index:10002;
      pointer-events:none;
    }
    .white-flash.show{ opacity:1; }

    /* back to the counter (hidden by default) */
    .back-counter{
      position: fixed;
      top: calc(env(safe-area-inset-top, 0px) + 10px);
      left: 6vw;
      z-index: 30;
      display: none;
      background: none; border: 0; padding: 0;
      color:#fff;
      font-family:'Cinzel', serif;
      font-style: italic;
      text-transform: lowercase;
      letter-spacing:.02em;
      cursor:pointer;
      text-shadow: 0 0 8px rgba(255,255,255,.7), 0 0 20px rgba(255,255,255,.35);
      animation: softFlicker 1.2s steps(2,end) infinite;
    }
    @keyframes softFlicker{
      0%,19%,21%,23%,25%,54%,56%,100%{opacity:1}
      20%,24%,55%{opacity:.55}
    }

    /* ===== MILESTONES ===== */
    .milestone{
      position:fixed; inset:0;
      display:flex; align-items:center; justify-content:center;
      background:#0aa84f;
      opacity:0; visibility:hidden;
      transition:opacity .14s ease;
      z-index:10001;
      pointer-events:none;
      isolation:isolate;
      mix-blend-mode:normal;
    }
    .milestone.show{ opacity:1; visibility:visible; }

    .milestone .inner{
      text-align: center;
      color: #fff;
      line-height: 1.1;
      white-space: pre-line;
      font-family: Helvetica, Arial, sans-serif;
      text-transform: none;
      text-shadow: 0 0 18px rgba(255,255,255,.25);
      padding: 4vmin 6vmin;
    }
    .milestone.red   { background:#d30000; }
    .milestone.green { background:#0aa84f; }
    .milestone.black { background:#000000; }

    /* size presets */
    .ms-huge   { font-weight: 900; font-size: clamp(3.4rem, 12vw, 12rem); }
    .ms-big    { font-weight: 900; font-size: clamp(2.6rem, 10vw, 10rem); }
    .ms-medium { font-weight: 800; font-size: clamp(1.4rem, 4vw, 3rem); }
    .ms-small  { font-weight: 600; font-size: clamp(0.95rem, 2.2vw, 1.3rem); line-height: 1.35; }

    /* modifiers */
    .ms-italic    { font-style: italic; }
    .ms-lowercase { text-transform: lowercase; }

    /* ====== SWITCHER (PLANNED ECONOMY) ====== */
    .switcher {
      /* CHANGED: let JS position it freely for DVD bounce */
      position: fixed;                 /* NEW / CHANGED */
      left: 120px; top: 120px;         /* NEW / CHANGED starting pos */
      font-family: Helvetica, Arial, sans-serif;
      font-weight: 800;
      font-size: 2.3rem;
      z-index: 10;
      display: flex; gap: 1rem;
      text-align: left;
      pointer-events: none;            /* keep clicks free */
      will-change: transform;          /* smoother RAF updates */
      transition: opacity .25s ease;
    }
    .switcher.is-hidden { opacity: 0; }
    .planned-word { display: flex; flex-direction: column; align-items: flex-start; line-height: 1.05; }
    .anti-word { visibility: hidden; font-size: 3.2rem; opacity: 0; color: white; transition: opacity .2s, color .2s; }
    .anti-word.visible-white { visibility: visible; opacity: 1; color: white; }
    .anti-word.visible-red   { visibility: visible; opacity: 1; color: red; }

    /* Edge flicker on the “PLANNED ECONOMY” when bouncing */
    .switcher.edge-flash .planned-word{               /* NEW */
      animation: edgeFlicker 0.42s steps(1,end) 3;
    }
    @keyframes edgeFlicker{                           /* NEW */
      0%,24%,48%,72%,100% { color:#ffffff; text-shadow:none; }
      12%,36%,60%,84%     { color:#ff2b2b; text-shadow:0 0 12px rgba(255,0,0,.65); }
    }

    /* Hero + content */
    .hero { min-height: calc(100vh - var(--band)); display: grid; place-items: center; position: relative; z-index: 3; }
    .hero-inner { display: grid; place-items: center; }

    /* CHANGED: title uses star flicker class only when JS adds it on dice roll */
    .text-flicker {                                     /* CHANGED */
      font-family: 'Cormorant Garamond', serif;
      font-size: 5rem;
      text-align: center;
      text-shadow: 0 0 8px rgba(255,255,255,0.5), 0 0 18px rgba(255,255,255,0.25);
    }
    .star-flick {                                       /* NEW: applied temporarily by JS on rolls */
      animation: flickerStars 0.9s steps(1,end);
    }
    @keyframes flickerStars{                             /* NEW: irregular twinkle */
      0%,7%,11%,19%,23%,31%,49%,61%,73%,100% { opacity:1; text-shadow:0 0 8px rgba(255,255,255,.6), 0 0 20px rgba(255,255,255,.4); }
      8%,20%,50%,62%                                   { opacity:.55; text-shadow:0 0 4px rgba(255,255,255,.25); }
      12%,33%,70%                                      { opacity:.2;  text-shadow:none; }
    }

    #enter-btn { margin-top: 2rem; font: inherit; font-size: 1.2rem; background: none; color: #fff; border: 1px solid #fff; padding: .5rem 1.5rem; cursor: pointer; }
    #enter-btn:hover { background: #fff; color: #000; }

    .content { font-size: 1.7rem; min-height: 100vh; display: flex; justify-content: center; align-items: center; z-index: 2; position: relative; opacity: 0; transform: translateY(50px); transition: all 1.2s ease; padding: 0 10vw; text-align: left; background: #000; }
    .content.visible { opacity: 1; transform: translateY(0); }

    .text-block {
      position: relative;
      max-width: 640px;
      margin: 0 auto;
    }
    .text-block p { margin: 0 0 1rem 0; line-height: 1.5; }

    /* JOIN badge */
    .join-badge{
      position: absolute;
      left: 50%;
      transform: translateX(-50%);
      top: calc(100% + 1rem);
      padding: .3rem 1.2rem;
      border: 1px solid #fff;
      font-family: 'Cinzel', serif;
      letter-spacing: .08em;
      opacity: 0;
      transition: opacity .18s ease;
      pointer-events: none;
    }
    .join-badge.show{ opacity: 1; }

    /* ===== PHONE REFINEMENTS ===== */
    @media (max-width: 820px){

      .text-flicker{
        position: fixed;
        top: calc(env(safe-area-inset-top, 0) + 4.2rem);
        left: 50%;
        transform: translateX(-50%);
        width: 92vw;
        text-align: center;
        font-size: clamp(3.2rem, 12vw, 4.6rem);
        line-height: 1;
        white-space: nowrap;
        z-index: 9;
      }

      /* keep the switcher legible on mobile; DVD motion is desktop */
      .switcher{                                       /* CHANGED for mobile */
        position: fixed;
        top: calc(env(safe-area-inset-top, 0) + 7.8rem);
        left: 50%;
        transform: translateX(-50%);
        width: 92vw;
        text-align: center;
        font-size: clamp(1.15rem, 5.8vw, 1.9rem);
        white-space: nowrap;
        gap: 0;
        z-index: 9;
      }
      .switcher .anti-word{
        font-size: inherit;
        margin-right: .1rem;
        position: relative;
        top: -0.06em;
      }
      .planned-word{ flex-direction: row; gap: .45rem; }
      .planned-word .line{ display:inline-block; }

      :root{ --dice: 76px; }
      .dice, .dice2{ left: 50%; transform: translateX(-50%); z-index: 12; }
      .dice  { top: 36vh; margin-left: calc(-0.70 * var(--dice)); }
      .dice2 { top: 44vh; margin-left: calc( 0.50 * var(--dice)); }

      #enter-btn{
        position: fixed;
        left: 50%;
        transform: translateX(-50%);
        top: 58vh;
        z-index: 15;
        pointer-events: auto;
      }

      .countdown-box{
        position: fixed; left: 5vw; right: auto;
        bottom: 8.6vh; top: auto; transform: none; text-align: left;
      }
      .countdown-box .digits{
        font-size: clamp(1.9rem, 8.2vw, 2.6rem);
        line-height: 1;
        font-variant-numeric: tabular-nums lining-nums;
        -moz-font-feature-settings: "tnum" 1, "lnum" 1;
        -webkit-font-feature-settings: "tnum" 1, "lnum" 1;
        font-feature-settings: "tnum" 1, "lnum" 1;
        transform: translateY(0.06em);
      }

      .stats{
        position: fixed; right: 5vw; left: auto;
        bottom: 8.6vh; top: auto; text-align: right;
        display: flex; flex-direction: column; align-items: flex-end;
      }
      .stats .basket-num{ order: 0; font-size: clamp(1.9rem, 8.2vw, 2.6rem); line-height: 1; }
      .stats .label     { order: 1; font-size: .95rem;  margin-top: .25rem; }
      .stats .basket-line{order: 2; font-size: 1.05rem; margin-top: .1rem;}

      body.reading #bg-img{ opacity: 0 !important; }
      body.reading #snake-canvas{ display: none !important; }
      body.reading .text-flicker,
      body.reading .switcher,
      body.reading .countdown-box,
      body.reading .stats{ display: none !important; }
      body.reading #enter-btn{ display: none !important; }

      body.reading .dice, body.reading .dice2{
        opacity: .26;
        z-index: 1;
        filter: drop-shadow(0 6px 12px rgba(0,0,0,.35));
        pointer-events: auto;
      }

      body.reading .content{ background: transparent !important; }

      body.reading .dice, body.reading .dice2{
        opacity: .34;
        filter: drop-shadow(0 6px 12px rgba(0,0,0,.35));
      }

      .content{ font-size: clamp(1.2rem, 5.4vw, 1.5rem); }

      .back-counter{ font-size: clamp(1.05rem, 4.8vw, 1.6rem); }
      body.reading .back-counter{ display: block; }
    }
  </style>
</head>
<body>
  <!-- Background slideshow -->
  <img src="images.jpeg" alt="Background" class="background-img" id="bg-img">
  <div class="black-flicker" id="black-fx"></div>

  <!-- Snake layer -->
  <canvas id="snake-canvas"></canvas>

  <!-- LEFT: DICE (two) -->
  <div class="dice dice1">
    <div class="gimbal">
      <div class="cube" id="cube1">
        <div class="face f1"><span class="pip" style="grid-area:2/2;"></span></div>
        <div class="face f2"><span class="pip" style="grid-area:1/1;"></span><span class="pip" style="grid-area:3/3;"></span></div>
        <div class="face f3"><span class="pip" style="grid-area:1/1;"></span><span class="pip" style="grid-area:2/2;"></span><span class="pip" style="grid-area:3/3;"></span></div>
        <div class="face f4"><span class="pip" style="grid-area:1/1;"></span><span class="pip" style="grid-area:1/3;"></span><span class="pip" style="grid-area:3/1;"></span><span class="pip" style="grid-area:3/3;"></span></div>
        <div class="face f5"><span class="pip" style="grid-area:1/1;"></span><span class="pip" style="grid-area:1/3;"></span><span class="pip" style="grid-area:2/2;"></span><span class="pip" style="grid-area:3/1;"></span><span class="pip" style="grid-area:3/3;"></span></div>
        <div class="face f6"><span class="pip" style="grid-area:1/1;"></span><span class="pip" style="grid-area:2/1;"></span><span class="pip" style="grid-area:3/1;"></span><span class="pip" style="grid-area:1/3;"></span><span class="pip" style="grid-area:2/3;"></span><span class="pip" style="grid-area:3/3;"></span></div>
      </div>
    </div>
  </div>

  <div class="dice dice2">
    <div class="gimbal">
      <div class="cube" id="cube2">
        <div class="face f1"><span class="pip" style="grid-area:2/2;"></span></div>
        <div class="face f2"><span class="pip" style="grid-area:1/1;"></span><span class="pip" style="grid-area:3/3;"></span></div>
        <div class="face f3"><span class="pip" style="grid-area:1/1;"></span><span class="pip" style="grid-area:2/2;"></span><span class="pip" style="grid-area:3/3;"></span></div>
        <div class="face f4"><span class="pip" style="grid-area:1/1;"></span><span class="pip" style="grid-area:1/3;"></span><span class="pip" style="grid-area:3/1;"></span><span class="pip" style="grid-area:3/3;"></span></div>
        <div class="face f5"><span class="pip" style="grid-area:1/1;"></span><span class="pip" style="grid-area:1/3;"></span><span class="pip" style="grid-area:2/2;"></span><span class="pip" style="grid-area:3/1;"></span><span class="pip" style="grid-area:3/3;"></span></div>
        <div class="face f6"><span class="pip" style="grid-area:1/1;"></span><span class="pip" style="grid-area:2/1;"></span><span class="pip" style="grid-area:3/1;"></span><span class="pip" style="grid-area:1/3;"></span><span class="pip" style="grid-area:2/3;"></span><span class="pip" style="grid-area:3/3;"></span></div>
      </div>
    </div>
  </div>

  <!-- RIGHT: Stats (top-right) -->
  <aside class="stats">
    <div class="label">PERFUMES</div>
    <div class="basket-line">IN YOUR BASKET:</div>
    <span id="basket-num" class="basket-num">0</span>
  </aside>

  <!-- RIGHT: Countdown (lower-right) -->
  <aside class="countdown-box">
    <div id="countdown" class="digits">00:00:00</div>
  </aside>

  <!-- Red combo overlay -->
  <div class="combo-overlay" id="combo-overlay">
    <div class="big" id="combo-text"></div>
  </div>

  <div id="white-flash" class="white-flash"></div>
  
  <!-- Milestone overlay (big messages on color backgrounds) -->
  <div id="milestone" class="milestone">
    <div id="milestone-inner" class="inner ms-big"></div>
  </div>

  <button id="back-btn" class="back-counter">back to the counter</button>

  <!-- Center label -->
  <div class="switcher" id="switcher">
    <span class="anti-word" id="anti-text">ANTI-</span>
    <div class="planned-word">
      <span class="line">PLANNED</span>
      <span class="line">ECONOMY</span>
    </div>
  </div>

  <!-- Hero -->
  <section class="hero">
    <div class="hero-inner">
      <div class="text-flicker" id="title">ЕLSIE INC.</div>
      <button id="enter-btn">ENTER</button>
    </div>
  </section>

  <!-- Content -->
  <section class="content" id="reveal">
    <div class="text-block">
      <p><strong>ELSIE INC</strong> is a perfume salon.</p>
      <p>We work on the <em>Playground for the Muddle of History</em> with angel investors, soft speculators, and practitioners of the <span style="
        display: inline-block;
        transform: scaleX(-1);
        font-style: italic;
      ">transcendental turn</span> <span style="display:inline-block; transform: scaleX(-1);">...</span></p>
      <p>Our primary goal is consensual abductive teamwork. Here, we are teaching a course on hyperadaptive identities.</p>
      <div id="join-badge" class="join-badge">JOIN</div>
    </div>
  </section>

  <script>
    /* Start at top */
    try { if ('scrollRestoration' in history) history.scrollRestoration = 'manual'; } catch(e){}
    window.addEventListener('load', () => window.scrollTo(0, 0));

    /* UI: ENTER + reveal */
    const enterBtn  = document.getElementById('enter-btn');
    const title     = document.getElementById('title');
    const reveal    = document.getElementById('reveal');
    const antiText  = document.getElementById('anti-text');
    const switcher  = document.getElementById('switcher');

    enterBtn.addEventListener('click', () => {
      // mobile-only reading mode
      if (window.matchMedia('(max-width: 820px)').matches) {
        document.body.classList.add('reading');
      }

      // your existing behavior
      title.style.opacity = '1';
      enterBtn.style.display = 'none';
      switcher.classList.add('is-hidden');
      window.scrollTo({ top: reveal.offsetTop, behavior: 'smooth' });
    });

    const backBtn = document.getElementById('back-btn');
    if (backBtn) {
      backBtn.addEventListener('click', () => {
        document.body.classList.remove('reading');
        window.scrollTo({ top: 0, behavior: 'smooth' });
      });
    }

    window.addEventListener('scroll', () => {
      const rect = reveal.getBoundingClientRect();
      if (rect.top < window.innerHeight) {
        reveal.classList.add('visible');
        switcher.classList.add('is-hidden');
        contentVisible = true;     
      }
    });

    /* ====== DVD-style bounce for PLANNED ECONOMY (desktop) ====== */
    const PE = switcher;                   /* NEW */
    const ANTI = antiText;                 /* NEW */
    let x = 120, y = 120;                  /* NEW */
    let vx = 160, vy = 160;                /* px/s -> 45° */ /* NEW */
    const margin = 8;                      /* NEW */
    let last = performance.now();          /* NEW */

    function peSize(){ return PE.getBoundingClientRect(); } /* NEW */

    function hitEdgeFlash(){               /* NEW */
      ANTI.className = 'anti-word visible-red';
      PE.classList.add('edge-flash');
      setTimeout(() => {
        PE.classList.remove('edge-flash');
        ANTI.className = 'anti-word';
      }, 520);
    }

    function rafPE(t){                     /* NEW */
      if (window.matchMedia('(max-width: 820px)').matches) return;  // desktop only
      const dt = (t - last) / 1000;
      last = t;

      x += vx * dt; y += vy * dt;

      const r = peSize();
      const maxX = innerWidth  - r.width  - margin;
      const maxY = innerHeight - r.height - margin;

      let bounced = false;
      if (x <= margin) { x = margin; vx = Math.abs(vx); bounced = true; }
      if (x >= maxX)   { x = maxX;   vx = -Math.abs(vx); bounced = true; }
      if (y <= margin) { y = margin; vy = Math.abs(vy); bounced = true; }
      if (y >= maxY)   { y = maxY;   vy = -Math.abs(vy); bounced = true; }
      if (bounced) hitEdgeFlash();

      PE.style.transform = `translate3d(${x}px, ${y}px, 0)`;
      requestAnimationFrame(rafPE);
    }
    if (!window.matchMedia('(max-width: 820px)').matches) {
      requestAnimationFrame(rafPE);
    }

    /* ---------- Slideshow (4s) ---------- */
    const BG = document.getElementById('bg-img');
    const FX = document.getElementById('black-fx');

    const IMAGES = [
      'images.jpeg',
      '01.png','02.png','02.jpg','03.png','03.jpg',
      '04.jpg','05.jpg','06.jpg','07.jpg','08.jpg',
      '09.jpg','010.jpg','011.jpg','012.jpg','013.jpg'
    ];
    IMAGES.forEach(src => { const i = new Image(); i.src = src; });

    const SHOW_MS = 4000, FLICK_MS = 120;
    let idx = 1;

    /* ---------- Dice ---------- */
    const cube1 = document.getElementById('cube1');
    const cube2 = document.get
